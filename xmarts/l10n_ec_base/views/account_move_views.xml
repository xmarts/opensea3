<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="view_move_in_latam_document_tree" model="ir.ui.view">
        <field name="name">account.move.in.latam.document.tree</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_in_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='ref']" position="after">
                <field name="l10n_latam_document_type_id"/>
                <field name="is_electronic_document"/>
                <field name="l10n_ec_emission_point_id"/>
            </xpath>
        </field>
    </record>

    <record id="view_invoice_tree_latam" model="ir.ui.view">
        <field name="name">account.move.invoice.tree.latam</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                <field name="l10n_latam_document_number"/>
                <field name="is_electronic_document"/>
            </xpath>
        </field>
    </record>

    <record id="view_move_out_latam_document_tree" model="ir.ui.view">
        <field name="name">account.move.out.latam.document.tree</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='ref']" position="after">
                <field name="l10n_latam_document_type_id"/>
                <field name="l10n_ec_emission_point_id"/>
            </xpath>
        </field>
    </record>

    <!-- ACCOUNT MOVE SEARCH VIEW INHERIT -->

    <record id="view_account_invoice_filter" model="ir.ui.view">
        <field name="name">account.invoice.select.inh</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='journal_id']" position="after">
                <field name="reversed_entry_id"/>
            </xpath>
        </field>
    </record>

    <!-- ACCOUNT MOVE FORM VIEW INHERIT -->

    <record id="view_move_reference_customer_form" model="ir.ui.view">
        <field name="name">account.move.reference.cust.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <div name="button_box" position="inside">
                <button class="oe_inline oe_stat_button"
                        name="%(account.action_move_out_refund_type)d"
                        groups="account.group_account_invoice"
                        type="action"
                        attrs="{'invisible':['|', '|', ('state', '!=', 'posted'), ('is_move_sent', '=', True),('move_type', 'not in', ('out_invoice','in_invoice'))]}"
                        icon="fa-file-text-o"
                        help="Credit Notes"
                        context="{'search_default_group_id': active_id, 'search_default_reversed_entry_id': active_id}">
                    <field string="Cred.Note" name="invoice_refund_counter" widget="statinfo"/>
                </button>
                <button class="oe_inline oe_stat_button"
                        name="button_open_withholdings"
                        groups="account.group_account_invoice"
                        type="object"
                        attrs="{'invisible':['|', '|', ('withholding_id','=', False), ('is_move_sent','=', True),('move_type','not in',('in_invoice','out_invoice','in_refund'))]}"
                        icon="fa-file-text"
                        help="Withholdings">
                    <field string="Withholdings" name="withholding_counter" widget="statinfo"/>
                </button>
            </div>
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="statusbar_visible">draft,posted,refund</attribute>
            </xpath>
            <xpath expr="//field[@name='state']" position="before">
                <button name="button_refund" string="Refund" type="object" groups="account.group_account_invoice" states="draft"/>
            </xpath>
            <xpath expr="//field[@name='invoice_date']" position="after">
                <field name="support_id"
                       attrs="{'required': [('move_type', 'not in', ['entry', 'in_receipt', 'out_receipt'])],'invisible': [('move_type', 'in', ['entry', 'in_receipt', 'out_receipt'])], 'readonly':[('state', '!=', 'draft')]}"
                       options="{'no_open': True, 'no_create': True, 'no_create_edit': True}"/>
                <field name="l10n_ec_sri_payment_id" widget="selection" attrs="{'readonly':[('state', '!=', 'draft')],'required': [('move_type', 'not in', ('entry', 'in_receipt', 'out_receipt'))] ,'invisible':[('move_type', 'in', ('entry', 'in_receipt', 'out_receipt'))]}"/>
                <field name="l10n_ec_emission_point_id" string="Emission Point for Withholding" attrs="{'invisible': [('move_type', 'not in', ('in_invoice'))] ,'readonly': [('state','!=','draft')]}" options="{'no_create':True,'no_quick_create':True,'no_open':True,'no_create_edit': True}"/>
                <field name="l10n_ec_emission_point_id" string="Emission Point" attrs="{'required': ['|', ('move_type', 'in', ['out_refund', 'out_invoice']), ('l10n_latam_document_code','=', '03')], 'invisible': [('l10n_latam_document_code', 'not in', ('01','03')),('move_type', 'in', ('in_invoice', 'in_refund', 'in_receipt', 'entry'))], 'readonly': [('state','!=','draft')]}" options="{'no_create':True, 'no_quick_create':True,'no_open':True, 'no_create_edit': True}"/>
            </xpath>
            <xpath expr="//button[@name='button_draft'][last()]" position="after">
                <button name="button_add_withholding"
                        string="ADD WITHHOLDING"
                        context="{'search_default_group_id': active_id}"
                        type="object"
                        groups="account.group_account_invoice"
                        attrs="{'invisible': ['|',('move_type','not in',('in_invoice','out_invoice','in_refund')), ('state', '!=', 'posted')]}"/>
            </xpath>
            <xpath expr="//field[@name='journal_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath  expr="//div[@class='oe_title']/h1[@class='mt0']" position="before">
                <label for="l10n_latam_document_number" string="NÂ° Document" style="font-weight:bold;" attrs="{'invisible': ['|',('move_type','=','entry'), ('state', '!=', 'draft')]}"/>
                <h1 attrs="{'invisible': [('move_type','=','entry')]}">
                    <field name="l10n_latam_document_number" placeholder="001-001-123456789" attrs="{'readonly': ['|', '|','|',('state', '!=', 'draft'),('posted_before', '=', True), ('move_type', 'in', ('out_invoice', 'out_refund')), ('l10n_latam_document_code', '=', '03')]}"/>
                </h1>
            </xpath>
            <xpath expr="//div[@class='oe_title']/h1[@class='mt0']" position="replace">
                <h3 class="mt0" attrs="{'invisible':[('name', '=', '/'), ('posted_before', '=', False)]}">
                    <field name="name" attrs="{'readonly': ['|', '|', ('state', '!=', 'draft'), ('posted_before', '=', True), ('move_type', 'in', ('out_invoice', 'out_refund', 'in_refund', 'in_invoice'))]}" placeholder="JRNL/2016/00001"/>
                </h3>
            </xpath>
            <xpath expr="//field[@name='reversed_entry_id']" position="attributes">
                <attribute name="attrs">{'invisible': [('reversed_entry_id', '=', False)]}</attribute>
            </xpath>
            <xpath expr="//label[@for='ref']" position="attributes">
                <attribute name="attrs">{'invisible':  [('move_type', 'not in', ['out_refund','in_refund'])]}</attribute>
            </xpath>
            <xpath expr="//field[@name='ref']" position="attributes">
                <attribute name="attrs">{'required': [('move_type', 'in', ['out_refund','in_refund'])],'invisible': [('move_type', 'not in', ['out_refund','in_refund'])] ,'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='fiscal_position_id']" position="replace"></xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="vat"/>
                <field name="fiscal_position_id" attrs="{'invisible': [('move_type','=','entry')], 'required': [('move_type','!=','entry')]}"/>
            </xpath>
            <xpath expr="//page[@name='other_info']" position="inside">
                <group name="withholding">
                    <field name="has_withholding" invisible="1"/>
                    <field name="withholding_id" string="Withholding" readonly="1" invisible="1"/>
                    <field name="create_withholding_type" class="oe_inline" invisible="1"/>
                </group>
            </xpath>
            <xpath expr="//field[@name='ref']" position="after">
                <field name="l10n_latam_document_code" invisible="1"/>
                <field name="auth_number" attrs="{'invisible': ['|', ('move_type', 'in', ['out_invoice','out_refund', 'entry', 'in_receipt', 'out_receipt']),('l10n_latam_document_code','=','03')], 'required':['|', ('move_type', '=', 'in_refund'), ('l10n_latam_document_code', '=', '01')], 'readonly': [('state','!=', 'draft')]}"/>
            </xpath>
            <xpath expr="//group[@id='header_right_group']/div[@class='o_td_label']/label[2]" position="attributes">
                <attribute name="attrs">{'invisible': [('move_type', 'not in', ('in_invoice', 'liq_purchase', 'in_refund', 'in_receipt'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_date']" position="attributes">
                <attribute name="attrs">{'required': [('move_type','!=', 'entry')]}</attribute>
            </xpath>
            <xpath expr="//page[@id='other_tab']" position="attributes">
                <attribute name="attrs">{'invisible': [('move_type', 'not in', ('out_invoice', 'liq_purchase', 'out_refund', 'in_invoice', 'in_refund'))]}</attribute>
            </xpath>
            <xpath expr="//div[@class='o_td_label']/label[2]" position="attributes">
                <attribute name="attrs">{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt', 'liq_purchase'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="context">{'res_partner_search_mode': (context.get('default_move_type', 'entry') in ('out_invoice', 'out_refund', 'out_receipt') and 'customer') or (context.get('default_move_type', 'entry') in ('in_invoice', 'liq_purchase', 'in_refund', 'in_receipt') and 'supplier') or False}</attribute>
                <attribute name="attrs">{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt', 'liq_purchase'))]}</attribute>
            </xpath>
            <xpath expr="//group[@name='accounting_info_group']" position="attributes">
                <attribute name="attrs">{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'liq_purchase', 'in_invoice', 'in_refund'))]}</attribute>
            </xpath>
            <xpath expr="//group[@name='accounting_info_group']" position="attributes">
                <attribute name="attrs">{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'liq_purchase', 'in_invoice', 'in_refund'))]}</attribute>
            </xpath>
            <xpath expr="//notebook/page[last()]" position="after">
                <page name="refunds" string="Refund Details" attrs="{'invisible':['|',('move_type', '!=', 'in_invoice'), ('l10n_latam_document_code','not in', ('03', '15','41'))]}">
                    <field name="refund_move_ids" context="{'default_move_id': active_id}" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                </page>
            </xpath>
        </field>
    </record>

    <!-- INHERIT LATAM VIEW -->

    <record id="view_move_latam_document_form" model="ir.ui.view">
        <field name="name">account.move.latam.document.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="l10n_latam_invoice_document.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='l10n_latam_document_number']" position="replace">
            </xpath>
            <xpath expr="//field[@name='l10n_latam_document_type_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='l10n_latam_document_type_id']" position="after">
                <field name="is_electronic_document"/>
            </xpath>
        </field>
    </record>

    <!-- INHERIT ACTIONS -->


    <record id="account.action_move_out_invoice_type" model="ir.actions.act_window">
        <field name="context">{'default_move_type': 'out_invoice','search_default_l10n_latam_document_type': 1}</field>
    </record>

    <record id="account.action_move_in_invoice_type" model="ir.actions.act_window">
        <field name="context">{'default_move_type': 'in_invoice','search_default_l10n_latam_document_type': 1}</field>
    </record>


</odoo>
