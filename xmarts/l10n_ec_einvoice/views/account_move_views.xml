<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- ACCOUNT MOVE FORM -->

    <record id="view_account_move_epayment_form" model="ir.ui.view">
        <field name="name">account.move.epayment.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_invoice_sent']" position="before">
                <button name="action_generate_edocument"
                        type="object"
                        attrs="{'invisible':['|','|','|',('move_type', 'not in', ('out_invoice', 'in_invoice','out_refund')),('l10n_latam_document_code','not in', ('03', '18', '04')),('autorizado_sri','=',True),('state','!=','posted')]}"
                        string="Generar Doc. Electrónico"
                        class="oe_highlight"/>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button string="Consultar en SRI"
                        type="object"
                        icon="fa-refresh"
                        name="show_document_info"
                        class="oe_stat_button"/>
            </xpath>
            <xpath expr="//button[@name='action_invoice_sent']" position="attributes">
                <attribute name="attrs">{'invisible':['|', '|', '|',('state', '!=', 'posted'), ('is_move_sent', '=', True),  ('sent', '=', False), ('move_type', 'not in', ('out_invoice','in_invoice','out_refund'))]}</attribute>
            </xpath>
            <xpath expr="//notebook/page[last()]" position="after">
                <page name="einvoice" string="Facturación Electrónica" attrs="{'invisible':['|', ('move_type', 'in', ('entry', 'out_receipt', 'in_receipt')), ('l10n_latam_document_code','=', '01')]}">
                    <group>
                        <field name="sri_authorization_id" readonly="1" attrs="{'invisible': [('sri_authorization_id', '=',False)]}"/>
                        <field name="clave_acceso" readonly="1" invisible="1"/>
                        <field name="numero_autorizacion" readonly="1"/>
                        <field name="fecha_autorizacion" readonly="1"/>
                        <field name="estado_autorizacion" readonly="1"/>
                        <field name="ambiente" readonly="1"/>
                        <field name="autorizado_sri" readonly="1"/>
                        <field name="sent" invisible="1"/>
                        <field name="to_cancel" attrs="{'invisible': [('numero_autorizacion', '=', '')]}"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- ACCOUNT MOVE FILTER -->

    <record id="view_account_move_einvoice_filter" model="ir.ui.view">
        <field name="name">account.move.einvoice.filter</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='unpaid']" position="after">
                <filter name="einvoiced" string="Electrónicas" domain="[('autorizado_sri','=',True)]" help="Facturas electrónicas"/>
            </xpath>
        </field>
    </record>

    <!-- ACCOUNT MOVE TREE -->

    <record id="view_account_move_einvoice_tree" model="ir.ui.view">
        <field name="name">account.move.einvoice.tree</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='payment_state']" position="after">
                <field name="autorizado_sri" optional="show"/>
            </xpath>
        </field>
    </record>

</odoo>
